{
  "Provider": "openstack",
  "CheckID": "compute_instance_public_ip_exposed",
  "CheckTitle": "Compute instances are not exposed to the internet",
  "CheckType": [],
  "ServiceName": "compute",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "OpenStackInstance",
  "ResourceGroup": "compute",
  "Description": "**OpenStack compute instances** (VMs) are evaluated to verify that they are **not exposed to the internet** via public IP addresses (floating IPs or access IPs). Instances with public IPs are directly reachable from the internet, increasing attack surface. Best practices recommend accessing instances through **bastion hosts**, **VPN gateways**, or **load balancers** instead of direct public exposure.",
  "Risk": "Compute instances with public IP addresses are directly reachable from the internet, enabling unauthorized reconnaissance, port scanning, and exploitation of vulnerabilities. Attackers can directly target these instances for brute-force attacks, exploit delivery, credential stuffing, and malware injection. Public exposure bypasses network segmentation and defense-in-depth controls, increasing the attack surface. Instances with public IPs are also vulnerable to DDoS attacks and volumetric floods that can cause service disruption. Compromised public-facing instances become pivot points for lateral movement to internal infrastructure.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.openstack.org/neutron/latest/admin/intro-nat.html",
    "https://docs.openstack.org/security-guide/networking/architecture.html",
    "https://docs.openstack.org/neutron/latest/admin/intro-os-networking.html",
    "https://docs.openstack.org/api-ref/compute/#servers-servers"
  ],
  "Remediation": {
    "Code": {
      "CLI": "# Disassociate floating IP from instance\nopenstack server remove floating ip <instance_id> <floating_ip>\n\n# Delete floating IP (if no longer needed)\nopenstack floating ip delete <floating_ip>\n\n# Access via bastion host instead\nssh -J bastion-user@bastion-ip instance-user@<private_ip>",
      "NativeIaC": "",
      "Other": "**Option 1: Remove public IP (Horizon Dashboard)**\n1. Navigate to **Compute > Instances**\n2. Locate instance with public IP (check IP Address column)\n3. Select instance â†’ **Actions > Disassociate Floating IP**\n4. Confirm disassociation\n5. Access via bastion host or VPN instead\n\n**Option 2: Implement bastion architecture**\n1. Create dedicated **bastion host** in DMZ network with public IP\n2. Harden bastion with SSH key-only auth, fail2ban, port knocking\n3. Configure **security groups** allowing SSH only from corporate IPs to bastion\n4. Remove public IPs from application/database instances\n5. Access private instances via SSH tunneling: `ssh -J bastion private-instance`\n6. Document bastion access procedures and emergency break-glass process\n\n**Option 3: Use load balancer**\n1. Create Neutron LBaaS or Octavia load balancer with public IP\n2. Configure backend pool with private instance IPs\n3. Remove floating IPs from instances\n4. Access via load balancer endpoint (HTTPS termination, WAF, rate limiting)",
      "Terraform": "```hcl\n# Terraform: deploy instance without public IP (private network only)\n\nresource \"openstack_compute_instance_v2\" \"private_instance\" {\n  name            = \"private-instance\"\n  image_id        = var.image_id\n  flavor_id       = var.flavor_id\n  key_pair        = var.key_pair_name\n  security_groups = [\"internal-sg\"]\n\n  # Attach to private network ONLY (no floating IP)\n  network {\n    name = \"private-network\"\n  }\n\n  # Do NOT create floating IP association\n}\n\n# Bastion host for SSH access (only instance with public IP)\nresource \"openstack_compute_instance_v2\" \"bastion\" {\n  name            = \"bastion-host\"\n  image_id        = var.bastion_image_id\n  flavor_id       = \"small\"\n  key_pair        = var.bastion_keypair\n  security_groups = [\"bastion-sg\"]  # Restrict SSH to corporate IPs only\n\n  network {\n    name = \"dmz-network\"\n  }\n}\n\nresource \"openstack_networking_floatingip_v2\" \"bastion_fip\" {\n  pool = \"public\"\n}\n\nresource \"openstack_compute_floatingip_associate_v2\" \"bastion_fip_assoc\" {\n  floating_ip = openstack_networking_floatingip_v2.bastion_fip.address\n  instance_id = openstack_compute_instance_v2.bastion.id\n}\n\n# Security group for bastion (least privilege)\nresource \"openstack_networking_secgroup_v2\" \"bastion_sg\" {\n  name        = \"bastion-sg\"\n  description = \"Allow SSH from corporate IPs only\"\n}\n\nresource \"openstack_networking_secgroup_rule_v2\" \"bastion_ssh\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 22\n  port_range_max    = 22\n  remote_ip_prefix  = var.corporate_cidr  # e.g., 203.0.113.0/24\n  security_group_id = openstack_networking_secgroup_v2.bastion_sg.id\n}\n```"
    },
    "Recommendation": {
      "Text": "Implement **network segmentation** and minimize public exposure:\n- **Avoid public IPs** on application/database instances; use private networks only\n- Deploy **bastion hosts** (jump servers) in DMZ as single point of SSH access\n- Use **VPN gateways** (OpenVPN, WireGuard, IPsec) for operator access instead of public IPs\n- Implement **load balancers** (Octavia, HAProxy) with public IPs for web traffic, not direct instance exposure\n- Apply **least privilege security groups**: allow only required ports from specific sources\n- Enable **VPC peering** or **private links** for cross-project/region communication\n- Monitor **network flows** with flow logs and detect anomalous public IP allocations\n- Use **cloud NAT gateways** for outbound internet access without inbound exposure\n- Implement **WAF** (Web Application Firewall) in front of load balancers for public-facing apps\n- Document **network topology** with clear public/private boundaries and trust zones\n- Audit **floating IP allocations** regularly and reclaim unused IPs to reduce attack surface\n- Enforce **tagging policies** requiring justification for instances with public IPs",
      "Url": "https://hub.prowler.com/check/compute_instance_public_ip_exposed"
    }
  },
  "Categories": [
    "internet-exposed",
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "This check flags instances with any public IP (floating IP, access IP v4/v6). Some workloads legitimately require public IPs (bastion hosts, NAT gateways, public-facing load balancers). Review findings in context of architecture requirements. Private RFC1918 IPs (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16) are not flagged."
}
