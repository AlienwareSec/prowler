{
  "Provider": "gcp",
  "CheckID": "gke_cluster_no_default_service_account",
  "CheckTitle": "GKE cluster does not use the Compute Engine default service account",
  "CheckType": [],
  "ServiceName": "gke",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "container.googleapis.com/Cluster",
  "Description": "**GKE clusters** are evaluated for use of the **Compute Engine default service account** (`default`) as the node identity. The expectation is that clusters and node pools run with dedicated, minimally privileged IAM service accounts instead of the project-wide default.",
  "Risk": "**Default node service accounts** often have broad project access. If a node is compromised, its credentials can read secrets, modify resources, or delete infrastructure, enabling lateral movement and data exfiltration. This harms **confidentiality**, **integrity**, and **availability** across the environment.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://cloud.google.com/compute/docs/access/service-accounts#default_service_account",
    "https://docs.cloud.google.com/kubernetes-engine/docs/how-to/service-accounts",
    "https://docs.cloud.google.com/network-intelligence-center/docs/network-analyzer/insights/kubernetes-engine/gke-node-service-account",
    "https://docs.cloud.google.com/kubernetes-engine/docs/how-to/creating-a-cluster-windows",
    "https://docs.prowler.com/checks/gcp/google-cloud-kubernetes-policies/ensure-gke-clusters-are-not-running-using-the-compute-engine-default-service-account#terraform",
    "https://docs.cloud.google.com/kubernetes-engine/security/configure-node-service-accounts",
    "https://docs.cloud.google.com/kubernetes-engine/docs/how-to/node-pools",
    "https://docs.cloud.google.com/kubernetes-engine/docs/troubleshooting/service-accounts"
  ],
  "Remediation": {
    "Code": {
      "CLI": "gcloud container node-pools create <example_resource_name> --cluster=<example_resource_name> --location <example_resource_name> --service-account=<example_resource_name>@<example_resource_id>.iam.gserviceaccount.com",
      "NativeIaC": "",
      "Other": "1. In Google Cloud Console, go to Kubernetes Engine > Clusters and open your cluster\n2. Click Add node pool\n3. In Security > Service account, select your non-default service account and click Create\n4. In Nodes > Node Pools, delete the node pool(s) that show Service account = default",
      "Terraform": "```hcl\nresource \"google_container_node_pool\" \"<example_resource_name>\" {\n  name     = \"<example_resource_name>\"\n  cluster  = \"<example_resource_name>\"\n  location = \"<example_resource_name>\"\n\n  node_config {\n    service_account = \"<example_resource_name>@<example_resource_id>.iam.gserviceaccount.com\" # critical: use a custom SA, not the Compute Engine default\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Assign a **custom, least-privileged IAM service account** to each node pool instead of `default`.\n- Grant only permissions required for node logging/monitoring and operations\n- Enforce **separation of duties** and restrict impersonation\n- Periodically review roles and audit usage for **defense in depth**",
      "Url": "https://hub.prowler.com/check/gke_cluster_no_default_service_account"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "By default, nodes use the Compute Engine default service account when you create a new cluster."
}
